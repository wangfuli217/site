#+SETUPFILE: ~/site/tpl/wiki-tpl.org
#+TITLE: Emacs 快捷键
#+DATE: 2020-03-28 17:20:19

#+begin_quote
Emacs 被人诟病除了复杂的快捷键之外，就是 =Ctrl= 伤小拇指，几乎所有的快捷键都是以 =Ctrl= 或者 =Alt= 开始的。
于我而言，这倒不是关键（小拇指目前很健康），但是不同键盘的 Ctrl 键位置不同，这就很难受了。

有些使用 [[https://github.com/emacs-evil/evil][evil]] 来达到 Emacs 和 Vim 双修，弥补 Emacs 快捷键操作的缺陷，兼具 Emacs 和 Vim 的优点。目前出名的
Emacs kit 如 Spacemacs、DoomEmacs 都是这样。然而，我 Vim 用的不溜，没办法一开始就用的是 Emacs，而不是 Vim。

除了 evil 之外，[[https://github.com/xahlee/xah-fly-keys][xah-fly-keys]] 就是专门用来解决这个问题的，我试了，映射方式太变态了，而且文档很少，自定义比较麻烦。

我选择了 [[https://github.com/abo-abo/hydra][hydra]]，hydra 并不是像 xah-fly-keys 一样专项解决键映射问题，但是顺带可以解决了。选择 hydra 还有一点
是比较信任它的作者 abo-abo，他有几个开源的插件，著名的 swiper、avy、ace-windows 我都用了。
#+end_quote

hydra 只是以一个快捷键前缀开始重映射快捷键。但是 Emacs 的快捷键太多了，键盘上主功能区域的键基本上都用完了。
作为 Leader Key，如果再以 =Ctrl= 开始的话，就没有做映射的必要了。

我的目标并不是想做到像 Vim 一样区分模式编辑，而是减少 =Ctrl= 的使用频率，而使用使用更加合理的方式来编排所有
的快捷键（之前的快捷键编排不合理导致新增快捷键混乱，没有统一的规范）。

快捷键一般都是复合的键，由 Leader 键和操作键组合而成。主键盘区无论使用 =C-c= 作为前缀，还是 =M-;= 作为前缀
都会影响正常的快捷键使用，而且我并不想重新映射 =M= 开头的快捷键。

所以 Leader 键只能放到了功能键: =<f1> ~ <f12>= ，又因为如果统一使用一个前缀的话，单手复合快捷键操作起来并不
舒服，比如 =F2-o= 映射为打开文件就很顺手， =F2-w= 映射为保存文件操作起来就有点难受了。

因此，我的映射方法是将键盘按照左手、右手分开。如果操作键是右手区，那么 Leader 键就用左手区的，反之亦然。

这样，所有键盘上的 26 个字母大小写，以及标点符号都可以作为快捷键来使用了。

--------------------

*注意：下面的快捷键大多都是重新定义过的，与 Emacs 的默认快捷键不同。*

* 多光标编辑(multiple-cursors)

|-------+-------+------------|
| 前缀  | 后缀  | 说明       |
|-------+-------+------------|
| =M-s= | =;=   | 当前函数   |
|       | =>=   | 选中后一个 |
|       | =<=   | 选中前一个 |
|       | =C-a= | 全部选中   |
|-------+-------+------------|

* avy

|-------+------+------------------------------------|
| 前缀  | 后缀 | 说明                               |
|-------+------+------------------------------------|
| =M-s= | =i=  | 根据单词的第一个字母定位，快速跳转 |
|       | =j=  | 跳转到行                           |
|       | =k=  | 拷贝指定行到当前                   |
|-------+------+------------------------------------|

* 区域扩展(expand-region)

|-------+------+------------------------------|
| 前缀  | 后缀 | 说明                         |
|-------+------+------------------------------|
| =M=   | =m=  | expand-region                |
| =M-s= | =s=  | 选中当前符号                 |
|       | =p=  | 选中当前括号(包含括号本身)   |
|       | =P=  | 选中当前括号(不包含括号本身) |
|       | =q=  | 选中当前引用(包含 =`= )      |
|       | =Q=  | 选中当前引用(不包含 =`= )    |
|       | =m=  | 选中当前注释                 |
|       | =f=  | 选中当前函数                 |
|-------+------+------------------------------|

* 符号高亮（highlight-symbol）

|------+------+------------------|
| 前缀 | 后缀 | 说明             |
|------+------+------------------|
| =M=  | =-=  | 当前单词全部高亮 |
|      | =n=  | 调转到下一个     |
|      | =p=  | 跳转到上一个     |
|------+------+------------------|

* ivy + counsel + swiper

|-------+------+--------------------------------|
| 前缀  | 后缀 | 说明                           |
|-------+------+--------------------------------|
| =C=   | =s=  | 当前文档搜索                   |
| =M=   | =x=  | 覆盖默认 =M-x=                 |
|       | =y=  | 粘贴历史                       |
| =M-s= | =.=  | 当前文档搜索当前单词           |
| =C-x= | =f=  | 覆盖默认 =C-x f=               |
| =C-c= | =g=  | 当前 git 项目中打开文件        |
|       | =j=  | 当前 git 项目中搜索, 使用 grep |
|       | =k=  | 当前 git 项目中搜索, 使用 ag   |
|-------+------+--------------------------------|

* vc + git-gutter+

|-------+-------+-----------------------|
| 前缀  | 后缀  | 说明                  |
|-------+-------+-----------------------|
| =C-x= | =g=   | enable/disable gutter |
|       | =n=   | 下一个修改            |
|       | =p=   | 上一个修改            |
|       | =r=   | revert 修改           |
|       | ~v =~ | vc diff               |
|       | =v l= | vc 日志               |
|-------+-------+-----------------------|

* Window + ace-windows

|-------+-------------+----------------|
| 前缀  | 后缀        | 说明           |
|-------+-------------+----------------|
| =C-x= | =1=         | 只显示当前窗口 |
|       | =2=         | 垂直分屏       |
|       | =3=         | 水平分屏       |
|       | =0=         | 当前窗口隐藏   |
| =M-o= | =1/2/3/...= | 切换窗口       |
| =M-s= | =t=         | 交换窗口位置   |
|-------+-------------+----------------|

* 项目管理(projectile)

|---------+-------+------------------------------------------------------------------------------------|
| 前缀    | 后缀  | 说明                                                                               |
|---------+-------+------------------------------------------------------------------------------------|
| =C-c p= | ~b~   | 切换 buffer，类似 ~C-x b~ ，只不过是针对当前项目的                                 |
|         | ~f~   | 在打开的项目中打开文件                                                             |
|         | ~i~   | 清空 projectile 当前项目的缓存（有的时候文件被删掉了需要清理一下，不然会造成干扰） |
|         | ~p~   | 切换项目                                                                           |
|         | ~s g~ | 当前项目下面下搜索，使用 grep 命令，不过我更喜欢用 ag => ~C-c p s s~ 或者 ~C-c k~  |
|---------+-------+------------------------------------------------------------------------------------|

* orgmode

|-------------+--------------------------------------------------------------|
| 快捷键      | 功能                                                         |
|-------------+--------------------------------------------------------------|
| =C-c C-e=   | Export or Publish                                            |
| =C-c C-l=   | 插入链接等                                                   |
| =C-c '=     | 在另外一个窗口编辑：代码，表格，公式等                       |
| =C-c C-x p= | 插入标题 =PROPERTIES=                                        |
| =C-c C-o=   | 打开当前链接 ~org-open-at-point~                             |
| =C-c C-,=   | 插入结构化模板（类似代码，引用等），orgmode 9.2 版本之后支持 |
| =C-c C-c=   | 标题上添加 Tag，可以用来分类或者打标签                       |
|-------------+--------------------------------------------------------------|

* 自定义扩展(hydra)

很有用但是用的频率不高且不是很好绑定的快捷键，使用 hydra 统一管理，

根据左右手的操作，我加了两个前缀 =F2= 和 =F8= 。

|------+--------+-------------------------------+---------------------------------------------------------|
| 前缀 | 复合键 | 绑定函数                      | 说明                                                    |
|------+--------+-------------------------------+---------------------------------------------------------|
| =F2= | =-=    | =shrink-window-horizontally=  | 水平缩小当前窗口大小                                    |
|      | ~=~    | =shrink-window=               | 垂直减小当前窗口大小                                    |
|      | =_=    | =enlarge-window-horizontally= | 水平扩大当前窗口大小                                    |
|      | =+=    | =enlarge-window=              | 垂直扩大当前窗口大小                                    |
|      | =m=    | =counsel-semantic-or-imenu=   |                                                         |
|      | =l=    | =display-line-numbers-mode=   | 显示行号                                                |
|      | =p=    | =show-file-name=              | 显示当前文件路径                                        |
|      | =<f2>= | nil                           | 退出 hydra                                              |
|------+--------+-------------------------------+---------------------------------------------------------|
| =F8= | =l=    | =insert-current-date-time=    | 插入当前时间，比如 <2020-03-27 21:59:04> 函数是自定义的 |
|      | =r=    | =ivy-resume=                  |                                                         |
|      | =x=    | =eshell=                      |                                                         |
|------+--------+-------------------------------+---------------------------------------------------------|
